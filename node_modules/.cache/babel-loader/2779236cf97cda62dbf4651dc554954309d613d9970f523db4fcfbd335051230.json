{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\lamtm\\\\Downloads\\\\cracklist-web\\\\src\\\\components\\\\Lobby.js\",\n  _s = $RefreshSig$();\n// src/components/Lobby.js\nimport React, { useEffect, useState } from 'react';\nimport { db } from '../firebase';\nimport { collection, doc, onSnapshot, setDoc, updateDoc, getDoc, getDocs } from 'firebase/firestore';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction Lobby({\n  gameCode,\n  pseudo,\n  isHost\n}) {\n  _s();\n  const [players, setPlayers] = useState([]);\n  const [gameStarted, setGameStarted] = useState(false);\n  useEffect(() => {\n    // Ajoute le joueur dans la sous-collection \"players\"\n    const playerRef = doc(db, \"games\", gameCode, \"players\", pseudo);\n    setDoc(playerRef, {\n      pseudo\n    }, {\n      merge: true\n    });\n\n    // Ã‰coute les changements de joueurs en temps rÃ©el\n    const unsubPlayers = onSnapshot(collection(db, \"games\", gameCode, \"players\"), snapshot => {\n      const list = snapshot.docs.map(doc => doc.data().pseudo);\n      setPlayers(list);\n    });\n\n    // Ã‰coute si la partie a commencÃ©\n    const unsubStarted = onSnapshot(doc(db, \"games\", gameCode), docSnap => {\n      if (docSnap.exists()) {\n        const data = docSnap.data();\n        setGameStarted(data.started);\n      }\n    });\n    return () => {\n      unsubPlayers();\n      unsubStarted();\n    };\n  }, [gameCode, pseudo]);\n  const handleStartGame = async () => {\n    // On rÃ©cupÃ¨re tous les joueurs\n    const snapshot = await getDocs(collection(db, \"games\", gameCode, \"players\"));\n    const joueurs = snapshot.docs.map(doc => doc.id);\n\n    // GÃ©nÃ¨re les cartes\n    const lettres = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\".split('');\n    const actions = [\"joker+1\", \"joker+2\", \"joker+3\", \"pass\", \"reverse\", \"crakitoko\"];\n    let pioche = [];\n\n    // MÃ©lange de lettres et cartes action\n    for (let i = 0; i < 3; i++) pioche.push(...lettres);\n    for (let i = 0; i < 6; i++) pioche.push(...actions);\n    pioche = pioche.sort(() => 0.5 - Math.random());\n\n    // Donne 8 cartes Ã  chaque joueur\n    for (const joueur of joueurs) {\n      const main = pioche.splice(0, 8);\n      await setDoc(doc(db, \"games\", gameCode, \"players\", joueur), {\n        pseudo: joueur,\n        cartes: main\n      }, {\n        merge: true\n      });\n    }\n\n    // On dÃ©finit le joueur actif et on stocke la pioche restante\n    await updateDoc(doc(db, \"games\", gameCode), {\n      started: true,\n      currentPlayer: joueurs[0],\n      sens: 1,\n      pioche: pioche\n    });\n  };\n  if (gameStarted) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        padding: 20\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"La partie commence ! \\uD83D\\uDD25\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Chargement de la salle de jeu...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: 20\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: [\"Lobby - Code : \", gameCode]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Joueurs connect\\xE9s :\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n      children: players.map(p => /*#__PURE__*/_jsxDEV(\"li\", {\n        children: p\n      }, p, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this), isHost && /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleStartGame,\n      style: {\n        marginTop: 20\n      },\n      children: \"\\uD83D\\uDE80 Lancer la partie\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        marginTop: 30\n      },\n      children: [\"\\uD83D\\uDD0A Pense \\xE0 jouer en vocal avec tes amis ! \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 51\n      }, this), \"(Tu peux cr\\xE9er un vocal Discord et partager le code)\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this);\n}\n_s(Lobby, \"UfAE+xel0cQWhWCh1izsqslqdew=\");\n_c = Lobby;\nexport default Lobby;\nvar _c;\n$RefreshReg$(_c, \"Lobby\");","map":{"version":3,"names":["React","useEffect","useState","db","collection","doc","onSnapshot","setDoc","updateDoc","getDoc","getDocs","jsxDEV","_jsxDEV","Lobby","gameCode","pseudo","isHost","_s","players","setPlayers","gameStarted","setGameStarted","playerRef","merge","unsubPlayers","snapshot","list","docs","map","data","unsubStarted","docSnap","exists","started","handleStartGame","joueurs","id","lettres","split","actions","pioche","i","push","sort","Math","random","joueur","main","splice","cartes","currentPlayer","sens","style","padding","children","fileName","_jsxFileName","lineNumber","columnNumber","p","onClick","marginTop","_c","$RefreshReg$"],"sources":["C:/Users/lamtm/Downloads/cracklist-web/src/components/Lobby.js"],"sourcesContent":["// src/components/Lobby.js\r\nimport React, { useEffect, useState } from 'react';\r\nimport { db } from '../firebase';\r\nimport {\r\n  collection,\r\n  doc,\r\n  onSnapshot,\r\n  setDoc,\r\n  updateDoc,\r\n  getDoc,\r\n  getDocs\r\n} from 'firebase/firestore';\r\n\r\nfunction Lobby({ gameCode, pseudo, isHost }) {\r\n  const [players, setPlayers] = useState([]);\r\n  const [gameStarted, setGameStarted] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // Ajoute le joueur dans la sous-collection \"players\"\r\n    const playerRef = doc(db, \"games\", gameCode, \"players\", pseudo);\r\n    setDoc(playerRef, { pseudo }, { merge: true });\r\n\r\n    // Ã‰coute les changements de joueurs en temps rÃ©el\r\n    const unsubPlayers = onSnapshot(\r\n      collection(db, \"games\", gameCode, \"players\"),\r\n      (snapshot) => {\r\n        const list = snapshot.docs.map((doc) => doc.data().pseudo);\r\n        setPlayers(list);\r\n      }\r\n    );\r\n\r\n    // Ã‰coute si la partie a commencÃ©\r\n    const unsubStarted = onSnapshot(doc(db, \"games\", gameCode), (docSnap) => {\r\n      if (docSnap.exists()) {\r\n        const data = docSnap.data();\r\n        setGameStarted(data.started);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      unsubPlayers();\r\n      unsubStarted();\r\n    };\r\n  }, [gameCode, pseudo]);\r\n\r\n  const handleStartGame = async () => {\r\n    // On rÃ©cupÃ¨re tous les joueurs\r\n    const snapshot = await getDocs(collection(db, \"games\", gameCode, \"players\"));\r\n    const joueurs = snapshot.docs.map(doc => doc.id);\r\n\r\n    // GÃ©nÃ¨re les cartes\r\n    const lettres = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\".split('');\r\n    const actions = [\"joker+1\", \"joker+2\", \"joker+3\", \"pass\", \"reverse\", \"crakitoko\"];\r\n    let pioche = [];\r\n\r\n    // MÃ©lange de lettres et cartes action\r\n    for (let i = 0; i < 3; i++) pioche.push(...lettres);\r\n    for (let i = 0; i < 6; i++) pioche.push(...actions);\r\n    pioche = pioche.sort(() => 0.5 - Math.random());\r\n\r\n    // Donne 8 cartes Ã  chaque joueur\r\n    for (const joueur of joueurs) {\r\n      const main = pioche.splice(0, 8);\r\n      await setDoc(doc(db, \"games\", gameCode, \"players\", joueur), {\r\n        pseudo: joueur,\r\n        cartes: main\r\n      }, { merge: true });\r\n    }\r\n\r\n    // On dÃ©finit le joueur actif et on stocke la pioche restante\r\n    await updateDoc(doc(db, \"games\", gameCode), {\r\n      started: true,\r\n      currentPlayer: joueurs[0],\r\n      sens: 1,\r\n      pioche: pioche\r\n    });\r\n  };\r\n\r\n  if (gameStarted) {\r\n    return (\r\n      <div style={{ padding: 20 }}>\r\n        <h2>La partie commence ! ðŸ”¥</h2>\r\n        <p>Chargement de la salle de jeu...</p>\r\n        {/* On redirigera vers Game.js dans App.js au prochain rendu */}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={{ padding: 20 }}>\r\n      <h2>Lobby - Code : {gameCode}</h2>\r\n      <p>Joueurs connectÃ©s :</p>\r\n      <ul>\r\n        {players.map((p) => (\r\n          <li key={p}>{p}</li>\r\n        ))}\r\n      </ul>\r\n\r\n      {isHost && (\r\n        <button onClick={handleStartGame} style={{ marginTop: 20 }}>\r\n          ðŸš€ Lancer la partie\r\n        </button>\r\n      )}\r\n\r\n      <p style={{ marginTop: 30 }}>\r\n        ðŸ”Š Pense Ã  jouer en vocal avec tes amis ! <br />\r\n        (Tu peux crÃ©er un vocal Discord et partager le code)\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Lobby;\r\n"],"mappings":";;AAAA;AACA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAClD,SAASC,EAAE,QAAQ,aAAa;AAChC,SACEC,UAAU,EACVC,GAAG,EACHC,UAAU,EACVC,MAAM,EACNC,SAAS,EACTC,MAAM,EACNC,OAAO,QACF,oBAAoB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE5B,SAASC,KAAKA,CAAC;EAAEC,QAAQ;EAAEC,MAAM;EAAEC;AAAO,CAAC,EAAE;EAAAC,EAAA;EAC3C,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGjB,QAAQ,CAAC,EAAE,CAAC;EAC1C,MAAM,CAACkB,WAAW,EAAEC,cAAc,CAAC,GAAGnB,QAAQ,CAAC,KAAK,CAAC;EAErDD,SAAS,CAAC,MAAM;IACd;IACA,MAAMqB,SAAS,GAAGjB,GAAG,CAACF,EAAE,EAAE,OAAO,EAAEW,QAAQ,EAAE,SAAS,EAAEC,MAAM,CAAC;IAC/DR,MAAM,CAACe,SAAS,EAAE;MAAEP;IAAO,CAAC,EAAE;MAAEQ,KAAK,EAAE;IAAK,CAAC,CAAC;;IAE9C;IACA,MAAMC,YAAY,GAAGlB,UAAU,CAC7BF,UAAU,CAACD,EAAE,EAAE,OAAO,EAAEW,QAAQ,EAAE,SAAS,CAAC,EAC3CW,QAAQ,IAAK;MACZ,MAAMC,IAAI,GAAGD,QAAQ,CAACE,IAAI,CAACC,GAAG,CAAEvB,GAAG,IAAKA,GAAG,CAACwB,IAAI,CAAC,CAAC,CAACd,MAAM,CAAC;MAC1DI,UAAU,CAACO,IAAI,CAAC;IAClB,CACF,CAAC;;IAED;IACA,MAAMI,YAAY,GAAGxB,UAAU,CAACD,GAAG,CAACF,EAAE,EAAE,OAAO,EAAEW,QAAQ,CAAC,EAAGiB,OAAO,IAAK;MACvE,IAAIA,OAAO,CAACC,MAAM,CAAC,CAAC,EAAE;QACpB,MAAMH,IAAI,GAAGE,OAAO,CAACF,IAAI,CAAC,CAAC;QAC3BR,cAAc,CAACQ,IAAI,CAACI,OAAO,CAAC;MAC9B;IACF,CAAC,CAAC;IAEF,OAAO,MAAM;MACXT,YAAY,CAAC,CAAC;MACdM,YAAY,CAAC,CAAC;IAChB,CAAC;EACH,CAAC,EAAE,CAAChB,QAAQ,EAAEC,MAAM,CAAC,CAAC;EAEtB,MAAMmB,eAAe,GAAG,MAAAA,CAAA,KAAY;IAClC;IACA,MAAMT,QAAQ,GAAG,MAAMf,OAAO,CAACN,UAAU,CAACD,EAAE,EAAE,OAAO,EAAEW,QAAQ,EAAE,SAAS,CAAC,CAAC;IAC5E,MAAMqB,OAAO,GAAGV,QAAQ,CAACE,IAAI,CAACC,GAAG,CAACvB,GAAG,IAAIA,GAAG,CAAC+B,EAAE,CAAC;;IAEhD;IACA,MAAMC,OAAO,GAAG,4BAA4B,CAACC,KAAK,CAAC,EAAE,CAAC;IACtD,MAAMC,OAAO,GAAG,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,MAAM,EAAE,SAAS,EAAE,WAAW,CAAC;IACjF,IAAIC,MAAM,GAAG,EAAE;;IAEf;IACA,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,CAAC,EAAEA,CAAC,EAAE,EAAED,MAAM,CAACE,IAAI,CAAC,GAAGL,OAAO,CAAC;IACnD,KAAK,IAAII,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,CAAC,EAAEA,CAAC,EAAE,EAAED,MAAM,CAACE,IAAI,CAAC,GAAGH,OAAO,CAAC;IACnDC,MAAM,GAAGA,MAAM,CAACG,IAAI,CAAC,MAAM,GAAG,GAAGC,IAAI,CAACC,MAAM,CAAC,CAAC,CAAC;;IAE/C;IACA,KAAK,MAAMC,MAAM,IAAIX,OAAO,EAAE;MAC5B,MAAMY,IAAI,GAAGP,MAAM,CAACQ,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC;MAChC,MAAMzC,MAAM,CAACF,GAAG,CAACF,EAAE,EAAE,OAAO,EAAEW,QAAQ,EAAE,SAAS,EAAEgC,MAAM,CAAC,EAAE;QAC1D/B,MAAM,EAAE+B,MAAM;QACdG,MAAM,EAAEF;MACV,CAAC,EAAE;QAAExB,KAAK,EAAE;MAAK,CAAC,CAAC;IACrB;;IAEA;IACA,MAAMf,SAAS,CAACH,GAAG,CAACF,EAAE,EAAE,OAAO,EAAEW,QAAQ,CAAC,EAAE;MAC1CmB,OAAO,EAAE,IAAI;MACbiB,aAAa,EAAEf,OAAO,CAAC,CAAC,CAAC;MACzBgB,IAAI,EAAE,CAAC;MACPX,MAAM,EAAEA;IACV,CAAC,CAAC;EACJ,CAAC;EAED,IAAIpB,WAAW,EAAE;IACf,oBACER,OAAA;MAAKwC,KAAK,EAAE;QAAEC,OAAO,EAAE;MAAG,CAAE;MAAAC,QAAA,gBAC1B1C,OAAA;QAAA0C,QAAA,EAAI;MAAuB;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAI,CAAC,eAChC9C,OAAA;QAAA0C,QAAA,EAAG;MAAgC;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAG,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAEpC,CAAC;EAEV;EAEA,oBACE9C,OAAA;IAAKwC,KAAK,EAAE;MAAEC,OAAO,EAAE;IAAG,CAAE;IAAAC,QAAA,gBAC1B1C,OAAA;MAAA0C,QAAA,GAAI,iBAAe,EAACxC,QAAQ;IAAA;MAAAyC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAK,CAAC,eAClC9C,OAAA;MAAA0C,QAAA,EAAG;IAAmB;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAG,CAAC,eAC1B9C,OAAA;MAAA0C,QAAA,EACGpC,OAAO,CAACU,GAAG,CAAE+B,CAAC,iBACb/C,OAAA;QAAA0C,QAAA,EAAaK;MAAC,GAALA,CAAC;QAAAJ,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAS,CACpB;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACA,CAAC,EAEJ1C,MAAM,iBACLJ,OAAA;MAAQgD,OAAO,EAAE1B,eAAgB;MAACkB,KAAK,EAAE;QAAES,SAAS,EAAE;MAAG,CAAE;MAAAP,QAAA,EAAC;IAE5D;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAQ,CACT,eAED9C,OAAA;MAAGwC,KAAK,EAAE;QAAES,SAAS,EAAE;MAAG,CAAE;MAAAP,QAAA,GAAC,yDACe,eAAA1C,OAAA;QAAA2C,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CAAC,2DAElD;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAG,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACD,CAAC;AAEV;AAACzC,EAAA,CAjGQJ,KAAK;AAAAiD,EAAA,GAALjD,KAAK;AAmGd,eAAeA,KAAK;AAAC,IAAAiD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}